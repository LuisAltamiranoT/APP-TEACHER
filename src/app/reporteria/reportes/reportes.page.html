<ion-header>
  <ion-toolbar>
  </ion-toolbar>
</ion-header>

<ion-content *ngIf="validateScanner else barra">
  <ion-grid>
    <ion-row class="ion-justify-content-center">
      <ion-col col-6 class="ion-align-self-center">
        <h3 class="font-weight-normal">
          <ion-icon name="reader-outline" class="fa-nival-bottom" style="padding-right: 3px;"></ion-icon>Reporte
          {{nombre}}
        </h3>
      </ion-col>
    </ion-row>
    <hr class="hr-nival" style="margin-top: -0.4rem;">
    <ion-row style="margin-top: -10px;">
      <ion-col col-6 class="ion-text-left">

        <button mat-button style="padding: 0px !important;"  (click)="exportToExcel()" [disabled]="!ValidateButton" >
          <ion-icon class="fa-nival" slot="start" name="cloud-download-outline" style="padding-right: 4px;"></ion-icon>Descargar
        </button>
      </ion-col>

      <ion-col col-6>
        <h3 style="float: right;">
          <button mat-button style="float: right; text-decoration: none;" (click)="verFiltros()">
            <ion-icon class="fa-nival" name="filter-outline" style="padding-right: 3px;">
            </ion-icon>Filtros
          </button>
        </h3>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col size="12">
        <form [formGroup]="fechaForm" (ngSubmit)="filtrar()" *ngIf="activarFiltros">
          <ion-row style="margin: 0px !important;">
            <ion-col size="6">
              <mat-form-field appearance="standard" class="input-modal">
                <mat-label>Inicio</mat-label>
                <input autocomplete="off" matInput [matDatepickerFilter]="myFilter" [matDatepicker]="picker"
                  formControlName="inicio" readonly (dateInput)="activarBusqueda()">
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>
              </mat-form-field>
            </ion-col>
            <ion-col size="6">
              <mat-form-field appearance="standard" class="input-modal">
                <mat-label>Final</mat-label>
                <input autocomplete="off" matInput [matDatepickerFilter]="myFilter" [matDatepicker]="picker1"
                  formControlName="fin" readonly (dateInput)="validarFecha($event, fechaForm.value)">
                <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
                <mat-datepicker #picker1></mat-datepicker>
              </mat-form-field>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col size="6">
              <button style="padding: 0px !important;" mat-button [disabled]="!limpiarInput" type="submit">
                <ion-icon class="fa-nival" name="search-outline" style="padding-right: 4px;"></ion-icon>
                Buscar
              </button>
            </ion-col>
            <ion-col size="6">
              <button style="padding: 0px !important;" mat-button type="reset" [disabled]="!limpiarInput" (click)="limpiarImput()" style="float: right;">
                <mat-icon matSuffix>backspace</mat-icon>
                Limpiar
              </button>
            </ion-col>
          </ion-row>
        </form>
        <mat-form-field class="input-modal busquedaForm">
          <mat-label>Buscar</mat-label>
          <input matInput autocomplete="off" (keyup)="applyFilter($event)" placeholder="Ejemplo 201720 o Pepito Perez"
            #input>
          <mat-icon matSuffix (click)="limpiarBusqueda(input)">backspace</mat-icon>
        </mat-form-field>
      </ion-col>
      <ion-col size="12">
        <div class="example-container mat-elevation-z3">
          <table mat-table [dataSource]="dataSource" #table>
            <ng-container *ngFor="let disCol of displayedColumns; let colIndex = index" [ngSwitch]="disCol"
              matColumnDef="{{disCol}}" [sticky]="isSticky(disCol)">
              <th mat-header-cell *matHeaderCellDef>{{disCol}}</th>

              <ng-container *ngSwitchCase="'Numero'">
                <td class="number" mat-cell *matCellDef="let element "> {{element[disCol]}}</td>
              </ng-container>

              <ng-container *ngSwitchCase="'Nombre'">
                <td class="td-left" mat-cell *matCellDef="let element "> {{element[disCol]}}</td>
              </ng-container>

              <ng-container *ngSwitchCase="'Imagen'">
                <td mat-cell *matCellDef="let element, let i = index;">
                  <a (click)="openPhoto(element[disCol])">
                    <mat-card class="mat-elevation-z0">
                      <div mat-card-avatar [style.background-image]="'url('+img+')'" class="avatarDiv">
                        <div mat-card-avatar [style.background-image]="'url('+element[disCol]+')'" class="avatarDiv">
                        </div>
                      </div>
                    </mat-card>
                  </a>
                </td>
              </ng-container>

              <ng-container *ngSwitchCase="'Porcentaje'">
                <td mat-cell *matCellDef="let element">{{element[disCol]}}</td>
              </ng-container>

              <ng-container *ngSwitchDefault>
                <td mat-cell *matCellDef="let element,let i = index;">
                  <button mat-button [ngStyle]="{'backgroundColor':getColor(element[disCol])}"
                    style="color: white; width: 100px; margin-left: 3px;"
                    (click)="onclick(element[disCol],element['Numero'],disCol)">{{element[disCol]}}</button>
                </td>
              </ng-container>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </div>
      </ion-col>
    </ion-row>
  </ion-grid>

</ion-content>

<ng-template #barra>
  <ion-content>
    <div class="spinnerA">
      <span class="spinnerB">
        <ion-spinner color="info" icon="spiral"></ion-spinner>
      </span>
    </div>
  </ion-content>
</ng-template>

<ion-footer>
  <ion-toolbar>
  </ion-toolbar>
</ion-footer>

